@model List<Lungisa.Services.FirebaseService.FirebaseProject>
@{
    ViewBag.Title = "Project Management";
    Layout = null;

    // Project to edit (from EditProject GET)
    var projectToEdit = ViewBag.ProjectToEdit as Lungisa.Services.FirebaseService.FirebaseProject;
    var projectKey = ViewBag.ProjectKey as string;
}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Projects Management</title>

    <link rel="stylesheet" href="~/css/formStyle.css" />
    <link rel="stylesheet" href="~/css/site.css" />
    <link rel="icon" type="image/png" sizes="32x32" href="~/Content/Images/LOGOLungisa.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
</head>
<body>

<header>
    <a class="logo" href="/"><img src="~/Content/Images/LungisaLogo.png" alt="Lungisa Logo"></a>
    <button class="menu-toggle" aria-label="Toggle navigation" aria-controls="main-nav" aria-expanded="false">
        <span></span><span></span><span></span>
    </button>
    <nav id="main-nav" class="main-nav">
        <ul>
            <li><a href="/Admin/AdminDashboard" class="nav-link">DASHBOARD</a></li>
            <li><a href="/DonationsAdmin" class="nav-link">DONATIONS</a></li>
            <li><a href="/Projects" class="nav-link active">PROJECTS</a></li>
            <li><a href="/Events" class="nav-link">EVENTS</a></li>
            <li><a href="/NewsAdmin" class="nav-link">NEWS</a></li>
            <li><a href="/Volunteers" class="nav-link ">VOLUNTEERS</a></li>
            <li><a href="/Subscribers" class="nav-link">SUBSCRIBERS</a></li>
            <li><a href="/Contacts" class="nav-link">CONTACT</a></li>
        </ul>
    </nav>
</header>

<div class="container">
    <h1>Manage Projects</h1>
    <p>Add, edit or delete organisational projects.</p>

    <section class="section-card1">
        <h2>@(projectKey != null ? "Edit Project" : "Add New Project")</h2>
            @if (TempData["Success"] != null)
            {
                <div class="success-message">@TempData["Success"]</div>
            }
        <br />
        <form action="@(projectKey != null ? "/Projects/UpdateProject" : "/Projects/AddProject")" method="post" enctype="multipart/form-data">
            @if(projectKey != null)
            {
                <input type="hidden" name="projectKey" value="@projectKey" />
            }

            <div class="form-group">
                <label>Title</label>
                <input name="title" type="text" required value="@(projectToEdit?.Project.Title ?? "")" />
            </div>


            <div class="form-group">
                <label for="project-type">Project Type</label>
                <select name="type" id="project-type" class="dropdown-project" required>
                    <option value="" disabled selected>Select a project type</option>

                    @if (projectToEdit?.Project.Type == "completed")
                    { <option value="completed" selected>Completed</option> }
                    else { <option value="completed">Completed</option> }

                    @if (projectToEdit?.Project.Type == "currently")
                    { <option value="currently" selected>Current</option> }
                    else { <option value="currently">Current</option> }

                    @if (projectToEdit?.Project.Type == "upcoming")
                    { <option value="upcoming" selected>Upcoming</option> }
                    else { <option value="upcoming">Upcoming</option> }
                </select>
            </div>

            <div class="form-group">
                <label>Description</label>
                <textarea name="description" rows="4" required>@(projectToEdit?.Project.Description ?? "")</textarea>
            </div>

            <div class="form-group">
                <label>Start Date</label>
                <input name="startDate" type="date" value="@(projectToEdit?.Project.StartDate ?? "")" />
            </div>

            <div class="form-group">
                <label>End Date</label>
                <input name="endDate" type="date" value="@(projectToEdit?.Project.EndDate ?? "")" />
            </div>

            <div class="form-group">
                <label>Upload Image</label>
                <input type="file" name="image" accept="image/*" />
                @if(projectToEdit?.Project.ImageUrl != null)
                {
                    <p>Current Image: <img src="@projectToEdit.Project.ImageUrl" width="100" /></p>
                }
            </div>

            <button class="btn-save" type="submit">
                @(projectKey != null ? "Update Project" : "Save Project")
            </button>
        </form>
    </section>

    <br /><br />

    <section class="section-card2">
        <h2>Existing Projects</h2>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        foreach (var item in Model)
                        {
                            if (item?.Project != null)
                            {
                                <tr>
                                    <td>@item.Project.Title</td>
                                    <td>@item.Project.Type</td>
                                    <td>@item.Project.Description</td>
                                    <td>@item.Project.StartDate</td>
                                    <td>@item.Project.EndDate</td>
                                    <td>
                                        <a class="btn-delete" href="/Projects/Delete/@item.Key" onclick="return confirm('Delete this project?');">Delete</a>
                                        <a class="btn-edit" href="/Projects/EditProject/@item.Key">Edit</a>
                                    </td>
                                </tr>
                            }
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="6">⚠️ No projects found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <p>Total Projects: @(Model?.Count ?? 0)</p>
    </section>
</div>
</body>
</html>
